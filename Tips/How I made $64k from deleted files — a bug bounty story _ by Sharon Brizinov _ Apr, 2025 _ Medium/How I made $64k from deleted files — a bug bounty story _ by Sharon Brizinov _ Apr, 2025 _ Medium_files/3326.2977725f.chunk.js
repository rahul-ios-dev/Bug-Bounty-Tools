"use strict";(self.webpackChunklite=self.webpackChunklite||[]).push([[3326],{48088:(e,n,i)=>{i.d(n,{h:()=>y});var a=i(64467),l=i(5544),t=i(55364),d=i.n(t),r=i(95420),u=i(96540),s=i(11321),o=i(21335),m=i(34317),k=i(49287),v=i(91830),c={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"useNewsletterV3Subscription_user"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"User"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"username"}},{kind:"Field",name:{kind:"Name",value:"newsletterV3"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"useNewsletterV3Subscription_newsletterV3"}}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"useNewsletterV3Subscription_newsletterV3"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"NewsletterV3"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"slug"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"collection"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"slug"}}]}},{kind:"Field",name:{kind:"Name",value:"user"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"username"}},{kind:"Field",name:{kind:"Name",value:"newsletterV3"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]}}]},N={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"SubscribeNewsletterV3Mutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"newsletterV3Id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"shouldRecordConsent"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"subscribeNewsletterV3"},arguments:[{kind:"Argument",name:{kind:"Name",value:"newsletterV3Id"},value:{kind:"Variable",name:{kind:"Name",value:"newsletterV3Id"}}},{kind:"Argument",name:{kind:"Name",value:"shouldRecordConsent"},value:{kind:"Variable",name:{kind:"Name",value:"shouldRecordConsent"}}}]}]}}]},b={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"UnsubscribeNewsletterV3Mutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"newsletterV3Id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"unsubscribeNewsletterV3"},arguments:[{kind:"Argument",name:{kind:"Name",value:"newsletterV3Id"},value:{kind:"Variable",name:{kind:"Name",value:"newsletterV3Id"}}}]}]}}]},S={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"FetchOrLazilyCreateNewsletterV3AndMaybeSubscribeMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"fetchOrLazilyCreateNewsletterV3AndMaybeSubscribe"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userId"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"FragmentSpread",name:{kind:"Name",value:"useNewsletterV3Subscription_newsletterV3"}}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"useNewsletterV3Subscription_newsletterV3"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"NewsletterV3"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"slug"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"collection"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"slug"}}]}},{kind:"Field",name:{kind:"Name",value:"user"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"username"}},{kind:"Field",name:{kind:"Name",value:"newsletterV3"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]}}]},w=i(21800),g=i(80452),p=i(2550),V=i(99766);function F(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),i.push.apply(i,a)}return i}function f(e){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?F(Object(i),!0).forEach((function(n){(0,a.A)(e,n,i[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):F(Object(i)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))}))}return e}var y=function(e){var n=e.newsletterV3,i=e.creator,a=e.newsletterName,t=e.hideLinkInConfirmationToast,F=void 0!==t&&t,y=n||{},I=y.id,D=y.type,E=y.slug,C=y.collection,h=(null==n?void 0:n.user)||i,O=null!=a?a:null==n?void 0:n.name,T=(0,p.A)().viewerId,A=(0,o.cd)(null==h?void 0:h.id),_=A.viewerEdge,P=A.loading,U=(0,g.h)(),j=u.useState(!1),M=(0,l.A)(j,2),L=M[0],R=M[1],q=(0,s.h)({newsletterSlug:E,collectionSlug:null==C?void 0:C.slug,username:null==h?void 0:h.username}),z=q.viewerEdge,B=q.loading,Q=u.useState(!1),G=(0,l.A)(Q,2),Y=G[0],x=G[1];u.useEffect((function(){x(!(null==z||!z.isSubscribed))}),[null==z?void 0:z.isSubscribed]);var W=(0,m.$L)(),X=(0,k.jI)(),$=(0,v.zF)();L&&W.event("newsletterV3.subscribe.error",{newsletterV3Id:I});var H=function(e,n,i){if(i){var a={id:"User:".concat(null==h?void 0:h.id),fragment:c,fragmentName:"useNewsletterV3Subscription_user"},l=e.readFragment(a);l&&e.writeFragment(f(f({},a),{},{data:f(f({},l),{},{newsletterV3:i})}))}if(z){var t=e.readQuery({query:V.k,variables:{newsletterSlug:E||"",collectionSlug:(null==C?void 0:C.slug)||null,username:(null==h?void 0:h.username)||null}}),r=d()({},t,{newsletterV3:{viewerEdge:{isSubscribed:n}}});e.writeQuery({query:V.k,variables:{newsletterSlug:E||"",collectionSlug:(null==C?void 0:C.slug)||null,username:(null==h?void 0:h.username)||null},data:r})}if(n&&null!=h&&h.id&&(null==_||!_.isFollowing)){var u=h.id;(0,w.M)({cache:e,userId:u,viewerId:T}),(0,o.YG)(e,u,{isFollowing:!0})}},J=(0,u.useCallback)((function(e){W.event("newsletterV3.subscribeClicked",{newsletterV3Id:e,source:X}),null!=_&&_.isFollowing||null==h||!h.id||U("user.followed",{targetUserId:h.id})}),[X,W,null==_?void 0:_.isFollowing,null==h?void 0:h.id,U]),K=(0,u.useCallback)((function(e){return function(n){var i=n.subscribeNewsletterV3;R(!i),i&&(J(I),e&&e(),x(!0))}}),[X,I,J]),Z=(0,r.n)(N,{optimisticResponse:{subscribeNewsletterV3:!0},update:function(e){H(e,!0)}}),ee=(0,l.A)(Z,1)[0],ne=(0,u.useCallback)((function(e){return function(n){var i=n.unsubscribeNewsletterV3;R(!i),i&&(W.event("newsletterV3.unsubscribeClicked",{newsletterV3Id:I,source:X}),x(!1),e?e():$({duration:F?5e3:"NEXTPAGE",toastStyle:"NEWSLETTER_UNSUBSCRIBE",extraParams:{newsletterName:O||null,newsletterType:D||null,unsubscribeFn:function(){return x(!1)},hideEmailSettingsLink:F,hideCloseButton:F}}))}}),[X,I,F,O,D]),ie=(0,r.n)(b,{optimisticResponse:{unsubscribeNewsletterV3:!0},update:function(e){H(e,!1)}}),ae=(0,l.A)(ie,1)[0],le=(0,u.useCallback)((function(e){return function(n){var i=n.fetchOrLazilyCreateNewsletterV3AndMaybeSubscribe;R(!i),i&&(J(i.id),e&&e(),x(!0))}}),[X,J]),te=(0,r.n)(S,{update:function(e,n){var i,a=f({},null===(i=n.data)||void 0===i?void 0:i.fetchOrLazilyCreateNewsletterV3AndMaybeSubscribe);H(e,!0,a)}}),de=(0,l.A)(te,1)[0];return{isSubscribed:Y,hasError:L,setSubscribe:function(e){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2?arguments[2]:void 0;R(!1),e&&!n&&null!=i&&i.id?de({variables:{userId:null==i?void 0:i.id},onCompleted:le(l)}):e&&null!=n&&n.id?ee({variables:{newsletterV3Id:null==n?void 0:n.id,shouldRecordConsent:a},onCompleted:K(l)}):null!=n&&n.id?ae({variables:{newsletterV3Id:null==n?void 0:n.id},onCompleted:ne(l)}):R(!0)},loading:B||P}}},99766:(e,n,i)=>{i.d(n,{k:()=>a});var a={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"NewsletterV3ViewerEdge"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"newsletterSlug"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"collectionSlug"}},type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"username"}},type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"newsletterV3"},arguments:[{kind:"Argument",name:{kind:"Name",value:"newsletterSlug"},value:{kind:"Variable",name:{kind:"Name",value:"newsletterSlug"}}},{kind:"Argument",name:{kind:"Name",value:"collectionSlug"},value:{kind:"Variable",name:{kind:"Name",value:"collectionSlug"}}},{kind:"Argument",name:{kind:"Name",value:"username"},value:{kind:"Variable",name:{kind:"Name",value:"username"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"NewsletterV3"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"viewerEdge"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"NewsletterV3ViewerEdge_newsletterV3ViewerEdge"}}]}}]}}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"NewsletterV3ViewerEdge_newsletterV3ViewerEdge"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"NewsletterV3ViewerEdge"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"isSubscribed"}}]}}]}},11321:(e,n,i)=>{i.d(n,{h:()=>t});var a=i(39181),l=i(99766),t=function(e){var n,i=e.newsletterSlug,t=void 0===i?"":i,d=e.collectionSlug,r=void 0===d?null:d,u=e.username,s=void 0===u?null:u,o=(0,a.I)(l.k,{variables:{newsletterSlug:t,collectionSlug:r,username:s},ssr:!1,skip:!t&&!s}),m=o.loading,k=o.error,v=o.data;return m?{loading:m}:k?{error:k}:{viewerEdge:null==v||null===(n=v.newsletterV3)||void 0===n?void 0:n.viewerEdge}}},21335:(e,n,i)=>{i.d(n,{sf:()=>s,YG:()=>r,cd:()=>u});var a=i(55364),l=i.n(a),t=i(39181),d={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"UserViewerEdge"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"user"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"User"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"viewerEdge"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"User_viewerEdge"}}]}}]}}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"User_viewerEdge"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"UserViewerEdge"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"createdAt"}},{kind:"Field",name:{kind:"Name",value:"hasCompletedProfile"}},{kind:"Field",name:{kind:"Name",value:"isAllowEdsEnabled"}},{kind:"Field",name:{kind:"Name",value:"isBlocking"}},{kind:"Field",name:{kind:"Name",value:"isFollowing"}},{kind:"Field",name:{kind:"Name",value:"isMuting"}},{kind:"Field",name:{kind:"Name",value:"isFacebookFollowing"}},{kind:"Field",name:{kind:"Name",value:"isMediumFollowing"}},{kind:"Field",name:{kind:"Name",value:"isSuperFollowing"}},{kind:"Field",name:{kind:"Name",value:"isTwitterFollowing"}},{kind:"Field",name:{kind:"Name",value:"isUser"}},{kind:"Field",name:{kind:"Name",value:"lastPostCreatedAt"}},{kind:"Field",name:{kind:"Name",value:"readPostsCount"}}]}}]};function r(e,n,i){var a=e.readQuery({query:d,variables:{userId:n}}),t=l()({},a,{user:{viewerEdge:i}});e.writeQuery({query:d,variables:{userId:n||""},data:t})}var u=function(e){var n,i=(0,t.I)(d,{variables:{userId:null!=e?e:""},ssr:!1,skip:!e}),a=i.loading,l=i.error,r=i.data;return a?{loading:a}:l?{error:l}:{viewerEdge:null==r||null===(n=r.user)||void 0===n?void 0:n.viewerEdge}},s=function(e,n){var i=n.userId,a=n.viewerId;return e.identify({__typename:"UserViewerEdge",id:"userId:".concat(i,"-viewerId:").concat(a)})}}}]);
//# sourceMappingURL=https://stats.medium.build/lite/sourcemaps/3326.2977725f.chunk.js.map